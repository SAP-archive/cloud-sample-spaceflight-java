const {Components: {DATA_CREATE_HANDLER, DATA_DELETE_HANDLER, DATA_READ_HANDLER, DATA_UPDATE_HANDLER}} = require('@sap/odata-v4')

const {FeatureNotSupported, RequestCannotBeParsed} = require('../../../errors')
const readToCQN = require('./readToCQN')
const updateToCQN = require('./updateToCQN')
const createToCQN = require('./createToCQN')
const deleteToCQN = require('./deleteToCQN')

/**
 * This method transforms an odata request into a CQN object.
 * @param {string} component - Component name.
 * @param {object} reflected - the reflected CSN model.
 * @param {string} serviceName - the name of the service.
 * @param context - Contains request information and utility methods like statements.
 * @param req - An odata request.
 */
const odataToCQN = (component, reflected, serviceName, context, req) => {
  try {
    switch (component) {
      case DATA_CREATE_HANDLER:
        return createToCQN(context, req)
      case DATA_DELETE_HANDLER:
        return deleteToCQN(context, req)
      case DATA_READ_HANDLER:
        return readToCQN(reflected, serviceName, context, req)
      case DATA_UPDATE_HANDLER:
        return updateToCQN(context, req)
      default:
        return {}
    }
  } catch (err) {
    if (err instanceof FeatureNotSupported) {
      throw err
    }

    throw new RequestCannotBeParsed(err)
  }
}

module.exports = odataToCQN
