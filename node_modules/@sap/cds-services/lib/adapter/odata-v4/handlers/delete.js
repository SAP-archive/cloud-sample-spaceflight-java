const {Components: {DATA_DELETE_HANDLER}} = require('@sap/odata-v4')
const getContextObject = require('../utils/context-object')
const {validateResourcePathLength} = require('../utils/request')

/**
 * The handler that will be registered with odata-v4.
 * @param {Service} service
 * @param {Object} options
 * @return {Function}
 */
const del = (service, options) => {
  return (req, res, next) => {
    // End here if length is greater then allowed
    validateResourcePathLength(req, options)

    service.processEvent('DELETE', getContextObject(DATA_DELETE_HANDLER, service, req))
      .then(() => {
        next(null, null)
      })
      .catch((err) => {
        next(err)
      })
  }
}

module.exports = del
